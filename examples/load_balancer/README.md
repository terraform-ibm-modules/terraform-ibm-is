# Load Balancer Module Example

This example illustrates how to use the `load_balancer` module.

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Inputs

Name                           | Description                                                                                                                                                                            | Type                                                                                                                                                                                                                                             | Default     | Required
------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------- | --------
resource_group                 | Resource group Name                                                                                                                                                                    | string                                                                                                                                                                                                                                           | null        | no
create_load_balancer           | True to create new Load Balancer. False if Load Balancer is already existing and Load Balancer pools/listeners are to be added                                                         | bool                                                                                                                                                                                                                                             | true        | yes
name                           | Name of the Load Balancer                                                                                                                                                              | string                                                                                                                                                                                                                                           | null        | yes
subnet_ids                     | List of subnet IDs for Load Balancer                                                                                                                                                   | list(string)                                                                                                                                                                                                                                     | []          | no
use_public_load_balancer       | Use public Load Balancer. If false, a private load balancer will be created.                                                                                                           | uebool                                                                                                                                                                                                                                           | true        | no
security_group_ids             | Load Balancer security groups ID list.                                                                                                                                                 | list(string)                                                                                                                                                                                                                                     | null        | no
logging                        | Logging of Load Balancer.                                                                                                                                                              | bool                                                                                                                                                                                                                                             | null        | no
tags                           | List of Tags for the Load Balancer                                                                                                                                                     | list(string)                                                                                                                                                                                                                                     | []          | no
pool_name                      | Name for the Load Balncer Pool where instances will be added.                                                                                                                          | string                                                                                                                                                                                                                                           |             | yes
pool_algorithm                 | Algorithm to be used for Load Balancer Pool. Can be `round_robin`, `weighted_round_robin`, or `least_connections`.                                                                     | string                                                                                                                                                                                                                                           | round_robin | yes
pool_protocol                  | Protocol for Load Balancer Pool. Can ve `http`, `https`, or `tcp`.                                                                                                                     | string                                                                                                                                                                                                                                           | http        | yes
pool_health_delay              | The Load Balancer Pool health check interval in seconds. Interval must be greater than timeout value.                                                                                  | number                                                                                                                                                                                                                                           | 15          | yes
pool_health_retries            | The Load Balancer Pool health check max retries.                                                                                                                                       | number                                                                                                                                                                                                                                           | 10          | yes
pool_health_timeout            | The Load Balancer Pool health check timeout in seconds.                                                                                                                                | number                                                                                                                                                                                                                                           | 10          | yes
pool_health_type               | Protocol for Load Balancer Health Check. Can ve `http`, `https`, or `tcp`.                                                                                                             | string                                                                                                                                                                                                                                           | http        | yes
pool_health_monitor_url        | Optional. Health Check URL for Load Balancer Pool. This option is only applicable with the `http` health check type.                                                                   | string                                                                                                                                                                                                                                           | null        | no
pool_health_monitor_port       | Optional. Load Balancer Pool health check port number.                                                                                                                                 | number                                                                                                                                                                                                                                           | null        | no
pool_session_persistence_type  | Optional. Load Balancer Pool Session Persistence type.                                                                                                                                 | string                                                                                                                                                                                                                                           | null        | no
pool_proxy_protocol            | Optional. The proxy protocol setting for the pool that is supported by the load balancers in the application family. Valid values are disabled, v1, and v2. Default value is disabled. | string                                                                                                                                                                                                                                           | disabled    | no
pool_members                   | List of load balancer pool members. These can be either an IP address or the GUID of a Virtual Server instance                                                                         | list(string)                                                                                                                                                                                                                                     |             | yes
pool_member_weights            | Optional. A list of weights for each of the pool members. This can only be used when the Load Balancer Pool algorithm is `weighted_round_robin`                                        | list(number)                                                                                                                                                                                                                                     | []          | no
pool_member_port               | The port number of the application running in the server.                                                                                                                              | number                                                                                                                                                                                                                                           |             | yes
listener_port                  | Listener port number.                                                                                                                                                                  | number                                                                                                                                                                                                                                           |             | yes
listener_protocol              | Protocol for Load Balancer Listener. Can ve `http`, `https`, or `tcp`.                                                                                                                 | string                                                                                                                                                                                                                                           | http        | yes
listener_certificate_instance  | The CRN of the certificate instance, it is applicable(mandatory) only to https protocol.                                                                                               | string                                                                                                                                                                                                                                           | null        | no
listener_accept_proxy_protocol | If set to true, listener forwards proxy protocol information that are supported by load balancers in the application family. Default value is false.                                   | bool                                                                                                                                                                                                                                             | false       | no
listener_connection_limit      | The connection limit of the listener. Valid range is 1 to 15000. Network load balancer do not support connection_limit argument.                                                       | number                                                                                                                                                                                                                                           | null        | no
listener_policies              | List of policies to apply to the load balancer listener and rules for each policy                                                                                                      | list(object({ name = string action = string priority = number target_id = string target_http_status_code = number target_url = string rules = list(object({ name = string condition = string type = string field = string value = string })) })) | []          | no

## Outputs

| Name | Description |
|------|-------------|
| lb\_id | The ID of the Load balancer |
| lb\_pools | All the Load balancer Pool IDs |
| lb\_pool\_members | All the Load balancer Pool Member IDs |
| lb\_listeners | All the Load balancer Listener IDs |
| lb\_listener\_policies | All the Load balancer Listener Policy IDs |
| lb\_listener\_policy\_rules | All the Load balancer Listener Policy Rule IDs |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

NOTE: We can configure the list of subnets, security_groups, tags, pools, listeners, listener_policies, listener_policy_rules to be attached to the Load balancer resources by entering respective details in input.tfvars.

## Usage

terraform apply -var-file="input.tfvars"

## Note

For all optional fields, default values (Eg: `null`) are given in varaible.tf file. User can configure the same by overwriting with appropriate values.